version: '3.8'

services:
  postgres:
    image: postgres:16.4
    restart: always
    environment:
      # üëâ –Ø–≤–Ω–æ –∑–∞–¥–∞—ë–º ‚Äî –ù–ï —á–µ—Ä–µ–∑ ${}, —á—Ç–æ–±—ã TimeWeb –Ω–µ –ø–æ—Ç–µ—Ä—è–ª.
      - POSTGRES_DB=n8n
      - POSTGRES_USER=admindev
      - POSTGRES_PASSWORD=clockwercktde5
      - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–∞–∑—ã ‚Äî –û–ö
      test: ['CMD-SHELL', 'pg_isready -U admindev']
      interval: 5s
      timeout: 5s
      retries: 5


  n8n:
    image: ghcr.io/n8n-io/n8n:latest
    restart: always
    environment:
      # üëâ –°–ª—É—à–∞–µ–º –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—Ç—É.
      - N8N_HOST=0.0.0.0
      - N8N_PORT=5678

      # –ë–∞–∑–∞ ‚Äî —è–≤–Ω–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —Ç–µ –∂–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ –∏ –≤ Postgres.
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=postgres
      - DB_POSTGRESDB_DATABASE=n8n
      - DB_POSTGRESDB_USER=admindev
      - DB_POSTGRESDB_PASSWORD=clockwercktde5

      # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π URL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫.
      - WEBHOOK_URL=https://rmay1er-n8n-timeweb-9012.twc1.net

      # –û—Ç–∫–ª—é—á–∞–µ–º —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é.
      - N8N_DIAGNOSTICS_ENABLED=false

    ports:
      - "5678:5678"

    volumes:
      - n8n_data:/n8n

    depends_on:
      postgres:
        condition: service_healthy

    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:5678/healthz']
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
    name: postgres_data_global
  n8n_data:
    name: n8n_data_global
