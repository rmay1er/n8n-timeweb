version: '3.8'

services:
  postgres:
    image: postgres:16.4
    restart: always
    environment:
      # –Ø–≤–Ω–æ –∑–∞–¥–∞—ë–º ‚Äî –ù–ï —á–µ—Ä–µ–∑ ${}, —á—Ç–æ–±—ã TimeWeb –Ω–µ –ø–æ—Ç–µ—Ä—è–ª.
      - POSTGRES_DB=n8n
      # üëâ unique_user - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ
      - POSTGRES_USER=unique_user
      # üëâ strong_password - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ
      - POSTGRES_PASSWORD=strong_password
      - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–∞–∑—ã ‚Äî –û–ö
      test: ['CMD-SHELL', 'pg_isready -U admindev']
      interval: 5s
      timeout: 5s
      retries: 5

  n8n:
    image: ghcr.io/n8n-io/n8n:latest
    restart: always
    environment:
      # –°–ª—É—à–∞–µ–º –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—Ç—É.
      - N8N_HOST=0.0.0.0
      - N8N_PORT=5678

      # –ë–∞–∑–∞ ‚Äî —è–≤–Ω–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —Ç–µ –∂–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ –∏ –≤ Postgres.
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=postgres
      - DB_POSTGRESDB_DATABASE=n8n
      # üëâ unique_user - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç–æ–∂–µ —Å–∞–º–æ–µ —á—Ç–æ –∏ –¥–ª—è postgress)
      - DB_POSTGRESDB_USER=unique_user
       # üëâ strong_password - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—ë –∑–Ω–∞—á–µ–Ω–∏–µ (—Ç–æ–∂–µ —Å–∞–º–æ–µ —á—Ç–æ –∏ –¥–ª—è postgress)
      - DB_POSTGRESDB_PASSWORD=password

      # üëâ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π URL, –≤—ã–¥–∞–Ω–Ω—ã–π TimeWeb, –Ω–∞–ø—Ä–∏–º–µ—Ä https://repo_name-timeweb-000.twc1.net
      - WEBHOOK_URL=

      # –û—Ç–∫–ª—é—á–∞–µ–º —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é.
      - N8N_DIAGNOSTICS_ENABLED=false

    ports:
      - "5678:5678"

    volumes:
      - n8n_data:/n8n

    depends_on:
      postgres:
        condition: service_healthy

    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:5678/healthz']
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
# –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –ø—É—Ç–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏, —á—Ç–æ –±—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.
  postgres_data:
    name: postgres_data_global
  n8n_data:
    name: n8n_data_global
